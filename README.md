# 심장질환·뇌혈관질환 재입원 위험률 및 요인 분석 

🏥국민건강보험공단의 표본 코호트(NHIS-NSC) 오픈데이터(진료내역, 출생/사망, 자격)를 통합하여 **심장질환(I20–I51)** 또는 **뇌혈관질환(I60–I69)** 으로 첫 입원 후 **동일상병 재입원 위험**을 분석
> -  **분석 언어**: R
> - **주요 라이브러리**: `tidyverse`, `readxl`, `survival`, `survminer`, `tableone`
> - **Event**: “첫 입원 퇴원 이후 동일 상병으로 첫 재입원” 발생  
> - **Time**: 퇴원일 → 첫 재입원일(사건) / 퇴원일 → 연구종료일 또는 3년(censoring)    
> - **주요 공변량**: 나이, 성별, **LOS(입원일수)**, 과거 180일 동반질환·외래·응급 이용지표

---

## 목차

- [프로젝트 소개](#심장질환뇌혈관질환-재입원-위험률-및-요인-분석)
- [📂 프로젝트 구조](#프로젝트-구조)
- [분석 절차 및 방법](#분석-절차-및-방법)
  - [1. 데이터 병합 및 코호트 정의](#1-데이터-병합-및-코호트-정의)
    - [데이터 & 변수](#데이터--변수)
  - [2. 기술 통계 분석](#2-기술-통계-분석)
  - [3. 생존분석 (Survival Analysis)](#3-생존분석-survival-analysis)
- [분석 파이프라인](#분석-파이프라인)
- [결과 요약](#결과-요약)
- [결과 분석 PPT](#결과-분석-ppt)

---


## 📂 프로젝트 구조

```bash
├─ R/
│  ├─ rr_first.R   # 데이터셋 통합, 변수 정의
│  ├─ rr_second.R  # 연구 대상자 확정
│  ├─ rr_ds2.R     # 재입원 vs 비재입원 
│  └─ rr_sa5.R     # 생존분석 - KM, CoxPH
├─ outputs/        # 결과 - csv
└─ plots/          # 결과 - 시각화
```
---


## 분석 절차 및 방법

### 1. 데이터 병합 및 코호트 정의
여러 데이터셋(`NSC2_M20`, `NSC2_BND`, `NSC2_BNC`)을 `RN_INDI`를 기준으로 병합 후 다음과 같은 기준으로 연구 대상자 코호트를 정의했다.
* **진단 기준**: 주상병 코드가 **심장 질환(I20-I51)** 또는 **뇌혈관 질환(I60-I69)** 에 해당하는 환자
* **입원 기록**: 해당 질환으로 최소 1회 이상 입원한 기록이 있는 환자
* **워시아웃(Washout) 기간**: 2006년 이전에 동일 질환으로 입원 기록이 있는 환자는 제외
* **제외 기준**: 입원 중 사망, 퇴원 기록 불분명, 나이 정보가 유효하지 않은 환자를 제외

#### 데이터 & 변수

- **데이터셋**
  - 진료내역(T20): `NSC2_M20.csv`, `NSC2_M20_1619.csv`
  - 자격(성별): `NSC2_BNC_V2_1.csv`, `NSC2_BNC_1619.csv`
  - 출생/사망: `NSC2_BND.csv`
- **핵심 변수**
  - `RN_INDI`(ID)
  - `MDCARE_STRT_DT`(진료시작일)
  - `FORM_CD`(입원=“02”)
  - `SICK_SYM1/2`(주/부상병)
  - `HSPTZ_PATH_TYPE`(내원경로)
  - `VSHSP_DD_CNT`(입내원일수=LOS)
  - `MCARE_RSLT_TYPE`(진료결과)
  - `BTH_YYYY`(출생연도), `DTH_YYYYMM`(사망연월)
- **파생 변수**
  - `DISCHARGE_DT`(퇴원일)
  - `age_index`(index 시점 나이)
  -  index기준 과거 180일 이용량·응급여부, 동반질환 (`hx_htn`, `hx_dm`, `hx_af`, `hx_ckd`, `hx_copd`, `hx_ihd`, `hx_hf`, `hx_dlp`, `hx_stroke`, `hx_cancer`)


### 2. 기술 통계 분석
`tableone` 패키지를 사용해 재입원 그룹과 비재입원 그룹 간의 환자 특성을 비교하는 표(`Table 1`)를 생성했다. 이를 통해 두 그룹의 기초적인 인구학적 및 임상적 특성 차이를 파악했다.

### 3. 생존분석 (Survival Analysis)
재입원 위험에 영향을 미치는 독립적인 요인들을 식별하기 위해 **생존분석**을 수행

* **Kaplan-Meier 분석**: 전체 환자 코호트의 재입원 위험률을 시각적으로 확인했다. 특히, 입원 기간(`VSHSP_DD_CNT`)의 중앙값인 **5일**을 기준으로 입원 기간이 5일 이상인 그룹과 미만인 그룹을 나누어 재입원 위험을 비교했다.

* **Cox 비례 위험 회귀 분석**: 재입원 위험에 영향을 미치는 독립적인 요인들을 식별하기 위해 다변량 Cox 회귀 모델을 구축했다. 모델에는 나이, 성별, 입원 기간, 고혈압 동반 질환 유무를 포함했다.
    * 결과 해석: 분석 결과, **고혈압 동반 질환 유무**와 **입원 기간**이 재입원 위험에 유의미한 영향을 미치는 것으로 나타났다.
        * 고혈압이 있는 환자는 그렇지 않은 환자보다 재입원 위험이 유의하게 높았다.
        * 입원 기간이 길수록 재입원 위험이 높아지는 경향을 보였다.


---

## 분석 파이프라인

1. **코호트 구성 & 워시아웃**
   - 심장(I20–I51) 또는 뇌혈관(I60–I69) 입원(FORM_CD="02") 최초 사례를 index로 정의
   - 2006-01-01 이전 동일상병 이력 워시아웃
   - 입원 중 사망/퇴원 불명확/나이 계산 불가 사례 제외
2. **그룹 라벨링**
   - index 이후 동일상병 재입원 여부로 `readmit_flag`(0/1) 생성
3. **과거 180일 이력**
   - 외래/응급/타입원 횟수 및 동반질환 flag(hx_*) 생성
4. **기술통계(Table 1)**
   - `wd_tbl1` 기준 재입원군 vs 비재입원군 비교(`Table_wd_final.csv`)
   - 데모 표본에서 **LOS(입원일수)**가 재입원군에서 유의하게 큼
5. **생존분석**
   - KM 곡선(전체 & LOS 중앙값 5일: `>=5` vs `<5`)과 risk table
   - 누적발생(1−S(t)), 누적위험 H(t), 랜드마크(30/90일/1·2·3년)
   - Cox PH: `Surv(time,event) ~ age10 + sex + los + hx_htn`

---
## 결과 요약
데모 표본 기반으로 진행한 분석이기에 표본 수가 매우 적어 추정의 불확실성이 크다.

입원일수(LOS)와 고혈압 과거력(hx_htn)은 재입원 위험 증가와 연관이 시사되나, 교란·잔여 편향 가능성이 있어 추가 검증이 필요하다.

---
## **<a id="결과 분석 PPT"></a> 결과 분석 PPT**
[의학통계실 최종발표 PPT](./docs/의학통계실_최종발표_이진솔.pdf)
